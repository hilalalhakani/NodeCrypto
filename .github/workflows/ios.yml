name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# jobs:
#   mac:
#     name: macOS
#     runs-on: macOS-13
#     steps:
#       - uses: actions/checkout@v3
#       # - name: Setup tmate session
#       #   uses: mxschmitt/action-tmate@v2
#       - name: Select Xcode 15.0.1
#         run: sudo xcode-select -s /Applications/Xcode_15.0.1.app
#       - name: Install yeetd
#         run: |
#           wget https://github.com/biscuitehh/yeetd/releases/download/1.0/yeetd-normal.pkg
#           sudo installer -pkg yeetd-normal.pkg -target /
#           yeetd &
#       - name: Enable macro
#         run: defaults write com.apple.dt.Xcode IDESkipMacroFingerprintValidation -bool YES
#       - name: Install Fastlane
#         run: |
#           gem install fastlane
#           fastlane env
#       - name: Build and test with Fastlane
#         run: fastlane run_appTests

jobs:
  mac:
    steps:
     name: macOS
     runs-on: macOS-13
     steps:
       - uses: actions/checkout@v3
       - name: Setup tmate session
         uses: mxschmitt/action-tmate@v2
       - name: Select Xcode 15.0.1
         run: sudo xcode-select -s /Applications/Xcode_15.0.1.app
       - name: Cache packages
         uses: actions/cache@v3
         id: packages-cache
         with:
          path: |
            packages_cache/artifacts
            packages_cache/checkouts
            packages_cache/workspace_state.json
          key: ${{ runner.os }}-packages-${{ hashFiles('**/Package.resolved') }}
          restore-keys: |
            ${{ runner.os }}-packages-
       - name: Build
         run: fastlane run_appTests
         env:
          HAS_PACKAGES_CACHE_HIT: ${{ steps.packages-cache.outputs.cache-hit == 'true' }}
